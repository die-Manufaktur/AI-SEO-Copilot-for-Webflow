name: Auto Create Pull Request

on:
  push:
    branches-ignore:
      - main

permissions:
  contents: read
  pull-requests: write

jobs:
  create-pull-request:
    name: Create Pull Request
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Pull Request
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BRANCH_NAME="${GITHUB_REF#refs/heads/}"
          
          # Check if PR already exists
          EXISTING_PR=$(gh pr list --head "$BRANCH_NAME" --base main --json number --jq '.[0].number')
          
          if [ "$EXISTING_PR" != "null" ] && [ -n "$EXISTING_PR" ]; then
            echo "âœ… Pull request already exists: #$EXISTING_PR"
          else
            COMMIT_MSG=$(git log -1 --pretty=format:"%s")
            
            gh pr create \
              --title "$COMMIT_MSG" \
              --body "Auto-generated pull request from branch: \`$BRANCH_NAME\`

## Changes
- $COMMIT_MSG

ðŸ¤– This PR was automatically created when you pushed to \`$BRANCH_NAME\`" \
              --base main \
              --head "$BRANCH_NAME" \
              --assignee "${{ github.actor }}"
            
            echo "âœ… Created pull request for branch: $BRANCH_NAME"
          fi